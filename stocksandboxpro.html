<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stock Sandbox Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/stocksandboxpro.css">
</head>
<body>
  <!-- Animated background particles -->
  <div class="particles" id="particles"></div>
  
  <!-- Auto-save indicator -->
  <div class="save-indicator" id="saveIndicator">
    <span class="status-dot"></span>
    <span id="saveText">Saved</span>
  </div>
  
  <!-- RS Productions Splash -->
  <div class="rs-splash" id="rsSplash">
    <div class="rs-particles" id="rsParticles"></div>
    <div class="rs-content">
      <div class="rs-title">
        <span class="rs-letter">R</span><span class="rs-letter">S</span>
      </div>
      <div class="rs-subtitle">Productions</div>
      <div class="rs-tagline">An RS Productions' Game</div>
    </div>
  </div>
  
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-content">
      <div class="loading-logo">STOCK SANDBOX</div>
      <div class="loading-text">Initializing market data...</div>
    </div>
  </div>

  <div class="app">
    <header>
      <div class="header-grid">
        <div class="logo">STOCK SANDBOX</div>
        
        <div class="balances">
          <div class="balance balance-clickable" id="cashBalance" title="Click for full amount">
            <div class="balance-label">Cash</div>
            <div class="balance-value" id="cash">$0.00</div>
          </div>
          <div class="balance balance-clickable" id="portfolioBalance" title="Click for full amount">
            <div class="balance-label">Portfolio</div>
            <div class="balance-value" id="portfolio">$0.00</div>
          </div>
          <div class="balance balance-clickable" id="totalBalance" title="Click for full amount">
            <div class="balance-label">Total</div>
            <div class="balance-value" id="total">$0.00</div>
          </div>
        </div>
        
        <div class="header-actions">
          <button class="btn btn-secondary btn-icon" id="helpBtn" title="Keyboard Shortcuts">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
          </button>
          <button class="btn btn-secondary btn-icon" id="quickBuyBtn" title="Quick Buy (Ctrl+B)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14"></path>
            </svg>
          </button>
          <button class="btn btn-secondary btn-icon" id="portfolioChartBtn" title="Portfolio Chart (Ctrl+P)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
          </button>
          <button class="btn btn-secondary btn-icon" id="settingsBtn" title="Settings (Ctrl+,)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6m8.66-15.66l-4.24 4.24m-4.24 4.24l-4.24 4.24m15.66-8.66l-4.24-4.24m-4.24-4.24l-4.24-4.24"></path>
            </svg>
          </button>
          <button class="btn btn-primary" id="viewHoldingsBtn" title="My Holdings (Ctrl+H)">My Holdings</button>
          <button class="btn btn-secondary" id="quitBtn" title="Save & Quit">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Quit
          </button>
          <div class="status-indicator">
            <span class="status-dot"></span>
            <span id="marketStatus">Loading...</span>
            <span id="cheatedIndicator" class="cheated" style="display:none">(CHEATED)</span>
          </div>
        </div>
      </div>
    </header>

    <div class="main-grid">
      <div class="stocks-panel">
        <div class="panel-header">
          <h2 class="panel-title">Market Overview</h2>
          <span class="status-indicator">250+ Symbols</span>
        </div>
        
        <div class="search-wrapper">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input type="text" class="search" id="search" placeholder="Search stocks by symbol or name..." />
        </div>
        
        <div class="stock-list" id="stockList"></div>
      </div>

      <div class="sidebar">
        <div class="stats-panel">
          <h2 class="panel-title">Quick Stats</h2>
          <div class="stat-grid">
            <div class="stat">
              <div class="stat-label">Top Gainer</div>
              <div class="stat-value" id="topGainer">--</div>
            </div>
            <div class="stat">
              <div class="stat-label">Top Loser</div>
              <div class="stat-value" id="topLoser">--</div>
            </div>
            <div class="stat">
              <div class="stat-label">24h Change</div>
              <div class="stat-value" id="dayChange">+0.00%</div>
            </div>
            <div class="stat">
              <div class="stat-label">All-Time High</div>
              <div class="stat-value" id="allTimeHigh">$100.00</div>
            </div>
          </div>
        </div>
        
        <div class="leaderboard-panel">
          <h2 class="panel-title">Global Leaderboard</h2>
          <div class="leaderboard-list" id="leaderboardList">
            <div class="empty-state">
              <div class="empty-icon">üèÜ</div>
              <p>Loading leaderboard...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal-overlay" id="loginModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Welcome to Stock Sandbox</h2>
      </div>
      <p style="color:var(--muted);margin-bottom:24px;font-size:14px">Create a new account or login to continue</p>
      <div class="btn-group">
        <button class="btn btn-primary btn-full" onclick="openCreateAccountModal()">Create Account</button>
        <button class="btn btn-secondary btn-full" onclick="openLoginModal()">Login</button>
      </div>
    </div>
  </div>

  <!-- Create Account Modal -->
  <div class="modal-overlay" id="createAccountModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Create Account</h2>
        <button class="close-btn" onclick="closeCreateAccountModal()">√É‚Äî</button>
      </div>
      
      <div id="createStep1">
        <div class="form-group">
          <label class="form-label">Choose Username</label>
          <input type="text" class="form-input" id="createUsername" placeholder="Enter a unique username" />
        </div>
        <button class="btn btn-primary btn-full" onclick="submitCreateAccount()">Create Account</button>
      </div>
      
      <div id="createStep2" style="display:none">
        <div class="form-group">
          <label class="form-label">Your Account Information (Save This!)</label>
          <textarea class="form-input" id="accountCodeDisplay" readonly></textarea>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="copyAccountCode()">Copy Code</button>
          <button class="btn btn-primary" onclick="finishCreateAccount()">Continue</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal-overlay" id="loginCodeModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Login</h2>
        <button class="close-btn" onclick="closeLoginCodeModal()">√É‚Äî</button>
      </div>
      <div class="form-group">
        <label class="form-label">Account ID or Username</label>
        <textarea class="form-input" id="loginCodeInput" placeholder="Enter your Account ID (e.g., 1) or Username"></textarea>
      </div>
      <button class="btn btn-primary btn-full" onclick="submitLogin()">Login</button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal modal-wide">
      <div class="modal-header">
        <h2 class="modal-title">Settings</h2>
        <button class="close-btn" id="closeSettingsModal">√É‚Äî</button>
      </div>
      
      <!-- Themes Section -->
      <div class="settings-section">
        <h3 class="settings-section-title">Themes</h3>
        <div class="theme-grid" id="themeGrid"></div>
      </div>
      
      <!-- Market Simulation Section -->
      <div class="settings-section">
        <h3 class="settings-section-title">Market Simulation</h3>
        <div class="settings-grid">
          <div class="form-group">
            <label class="form-label">Market Volatility</label>
            <select class="form-select" id="volatilitySetting">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
              <option value="insane">Insane</option>
              <option value="irresponsible">Irresponsible</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Market Trend Bias</label>
            <select class="form-select" id="trendBiasSetting">
              <option value="down-only">Down (only down)</option>
              <option value="bearish">Bearish (Downward)</option>
              <option value="neutral" selected>Neutral</option>
              <option value="bullish">Bullish (Upward)</option>
              <option value="up-only">Up (only up)</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Market Crash Frequency</label>
            <select class="form-select" id="crashFrequencySetting">
              <option value="never" selected>Never</option>
              <option value="very-rare">Very Rare</option>
              <option value="rare">Rare</option>
              <option value="occasional">Occasional</option>
              <option value="frequent">Frequent</option>
              <option value="very-frequent">Very Frequent</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Recovery Speed</label>
            <select class="form-select" id="recoverySpeedSetting">
              <option value="incredibly-slow">Incredibly Slow</option>
              <option value="really-slow">Really Slow</option>
              <option value="pretty-slow">Pretty Slow</option>
              <option value="slow">Slow</option>
              <option value="normal" selected>Normal</option>
              <option value="slightly-fast">Slightly Fast</option>
              <option value="fast">Fast</option>
              <option value="more-fast">More Fast</option>
              <option value="incredibly-fast">Incredibly Fast</option>
              <option value="almost-instant">Almost Instant</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Retail Trader Influence</label>
            <div class="toggle-group">
              <span style="color:var(--muted);font-size:14px">Add market noise from retail traders</span>
              <label class="toggle-switch">
                <input type="checkbox" id="retailInfluenceSetting">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Auto-Refresh Interval</label>
            <select class="form-select" id="refreshIntervalSetting">
              <option value="2000">2 seconds (Fast)</option>
              <option value="5000">5 seconds</option>
              <option value="10000" selected>10 seconds (Normal)</option>
              <option value="30000">30 seconds (Slow)</option>
            </select>
          </div>
        </div>
      </div>
      
      <!-- Account Section -->
      <div class="settings-section">
        <h3 class="settings-section-title">Account</h3>
        <div class="settings-grid">
          <div class="form-group">
            <label class="form-label">Username</label>
            <input type="text" class="form-input" id="displayUsername" readonly />
          </div>
          
          <div class="form-group">
            <label class="form-label">Account ID</label>
            <div class="btn-group">
              <button class="btn btn-secondary" onclick="showAccountCode()">View Info</button>
              <button class="btn btn-secondary" onclick="copyMyAccountCode()">Copy ID</button>
            </div>
          </div>
        </div>
      </div>
      
      <div style="display:flex;gap:12px;margin-top:24px">
        <button class="btn btn-primary btn-full" onclick="saveSettings()">Save Settings</button>
        <button class="btn btn-secondary" onclick="resetToDefaults()">Reset to Defaults</button>
      </div>
    </div>
  </div>

  <!-- Holdings Modal -->
  <div class="modal-overlay" id="holdingsModal">
    <div class="modal" style="max-width:900px">
      <div class="modal-header">
        <h2 class="modal-title">My Holdings</h2>
        <button class="close-btn" id="closeHoldingsModal">√É‚Äî</button>
      </div>
      <div class="holdings-grid" id="holdingsList"></div>
    </div>
  </div>

  <!-- Quick Buy Modal -->
  <div class="modal-overlay" id="quickBuyModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Quick Buy</h2>
        <button class="close-btn" id="closeQuickBuyModal">√ó</button>
      </div>
      
      <div class="form-group">
        <label class="form-label">Stock Symbol</label>
        <input type="text" class="form-input" id="quickBuySymbol" placeholder="e.g. AAPL, TSLA, BTC-USD" list="stockSuggestions" />
        <datalist id="stockSuggestions"></datalist>
      </div>
      
      <div class="form-group">
        <label class="form-label">Amount ($)</label>
        <div style="display:flex;gap:8px">
          <input type="number" class="form-input" id="quickBuyAmount" placeholder="Enter dollar amount" step="0.01" min="0.01" style="flex:1" />
          <button class="btn btn-secondary" id="quickBuyMaxBtn" style="padding:12px 20px">Max</button>
        </div>
      </div>
      
      <div style="padding:12px;background:rgba(0,229,255,0.1);border-radius:8px;margin-bottom:16px;font-size:13px;color:var(--muted)">
        <div id="quickBuyPreview">Enter a symbol and amount to see preview</div>
      </div>
      
      <button class="btn btn-primary btn-full" id="executeQuickBuy">Execute Buy</button>
    </div>
  </div>

  <!-- Portfolio Chart Modal -->
  <div class="modal-overlay" id="portfolioChartModal">
    <div class="modal" style="max-width:700px">
      <div class="modal-header">
        <h2 class="modal-title">Portfolio Performance</h2>
        <button class="close-btn" id="closePortfolioChartModal">√ó</button>
      </div>
      
      <div class="chart-wrapper">
        <canvas class="chart-canvas" id="portfolioChartCanvas" style="height:300px"></canvas>
      </div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-top:24px">
        <div class="stat">
          <div class="stat-label">Starting Value</div>
          <div class="stat-value" style="font-size:18px">$100.00</div>
        </div>
        <div class="stat">
          <div class="stat-label">Current Value</div>
          <div class="stat-value" style="font-size:18px" id="portfolioCurrentValue">$100.00</div>
        </div>
        <div class="stat">
          <div class="stat-label">Total Return</div>
          <div class="stat-value" style="font-size:18px" id="portfolioTotalReturn">+0.00%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stock Detail Modal -->
  <div class="modal-overlay" id="stockModal">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h2 class="modal-title" id="modalSym">--</h2>
          <p style="color:var(--muted);margin-top:4px;font-size:14px" id="modalName">--</p>
        </div>
        <button class="close-btn" id="closeStockModal">√É‚Äî</button>
      </div>
      
      <div class="chart-wrapper">
        <canvas class="chart-canvas" id="stockCanvas"></canvas>
      </div>
      
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <div>
          <div style="font-size:12px;color:var(--muted);margin-bottom:4px">Current Price</div>
          <div style="font-size:32px;font-weight:700;font-family:var(--font-mono)" id="modalPrice">$0.00</div>
        </div>
        <div id="modalTotalCost" style="font-size:16px;color:var(--muted)">Total: $0.00</div>
      </div>
      
      <div class="trade-controls">
        <div class="trade-input">
          <label class="form-label">Quantity</label>
          <input type="number" class="form-input" id="modalQty" step="0.00001" min="0.00001" placeholder="0.00000" />
        </div>
        <button class="btn btn-secondary" id="modalMaxBuy" style="align-self:flex-end" title="Buy max with available cash">Max Buy</button>
        <button class="btn btn-buy" id="modalBuy">Buy</button>
        <button class="btn btn-secondary" id="modalMaxSell" style="align-self:flex-end" title="Sell all shares">Max Sell</button>
        <button class="btn btn-sell" id="modalSell">Sell</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script src="js/stocksandboxpro.js"></script>
</body>
</html>
